<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Candidate Application Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
 


  <style>
  * {
    box-sizing: border-box;
    font-family: Verdana, Geneva, Tahoma, sans-serif;
  }
body {
  font-family:  'Inter', sans-serif;
  margin: -15px;
  padding: 0;
  background-color: #f9f9f9;
  color: #333;
}

h1 {
  font-family: Verdana, Geneva, Tahoma, sans-serif;
  font-weight: 900;
  font-size: 24px;
  text-align: center;
  color: #3f2c1f;
  margin-top: -32px;
}

  form {
    max-width: 900px;
    margin: 1rem auto;
    background: #fffaf0;
    padding: 2rem 3rem;
    border: 1px solid #d2c5ab;
    border-radius: 6px;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
  }

  h2, h3 {
    text-align: center;
    font-weight: normal;
    margin-bottom: 1.5rem;
    color: #3c2f2f;
  }
label {
  font-family: Arial, sans-serif;
  font-size: 1.1rem;     /* ~16px – standard mobile readable size */
  font-weight: 600;
  display: block;
  margin: 0.6rem 0 0.3rem;
  color: #5a4740;
}




  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="date"],
  select,
  textarea {
    width: 91%;
    padding: 0.65rem;
    font-size: 15px;
    background: #fffdf7;
    border: 1px solid #c8bca8;
    border-radius: 4px;
    margin-bottom: 1rem;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
  }

  textarea {
    resize: vertical;
  }

  select {
    background-color: #fffdf7;
  }

  button {
    background-color: #5a4031;
    color: #fff;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    background-color: #3f2c1f;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    font-size: 14px;
    background: #faf6ed;
    border: 1px solid #d5c7b1;
  }

  th, td {
    padding: 8px;
    text-align: left;
    border: 1px solid #ccc;
    word-wrap: break-word;
    white-space: normal;
  }
.experience-section {
    margin-bottom: 20px;
  }

  .experience-card {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    background-color: #f9f9f9;
    position: relative;
  }

  .experience-card label {
    font-weight: 500;
    display: block;
    margin-bottom: 5px;
    font-size: 14px;
  }

  .experience-card input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  .removeRowBtn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 18px;
    color: #d11a2a;
    cursor: pointer;
  }

  #addRowBtn {
    display: inline-block;
    margin-top: 10px;
    cursor: pointer;
    font-size: 16px;
    color: #0066cc;
  }

  #totalExperience {
    width: 100%;
    padding: 8px;
    font-weight: bold;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
/* Spinner animation */
.spinner {
    border: 8px solid #f3f3f3;
    border-top: 8px solid #6b4226;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
  
  /* Responsive styles */
  @media screen and (max-width: 768px) {
    h1 {
      font-size: 20px;
      padding: 16px;
    }
.experience-card {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 15px;
      align-items: start;
      padding-right: 40px;
    }

    .experience-card input {
      margin-bottom: 0;
    }

    .experience-card label {
      margin-bottom: 2px;
    }

    .experience-card > div {
      display: flex;
      flex-direction: column;
    }
  }
    form {
      padding: 1.5rem;
    }

    table, tbody, tr, td, th {
      display: block;
      width: 100%;
    }

    tr {
      margin-bottom: 1.5rem;
      background: #fdfaf4;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #e0d6c2;
    }

    td::before {
      content: attr(data-label);
      display: block;
      font-weight: bold;
      font-size: 14px;
      color: #5a4031;
      margin-bottom: 5px;
    }

    td label {
      display: none;
    }

    button {
      width: 23%;
      margin-top: 10px;
    }
  
</style>


</head>
<body>
  

<form id="candidateForm">


    <h1>P&C PROJECTS PRIVATE LIMITED</h1>
            <h2>Application Form</h2>

<!-- Full Name -->
<label for="full_name">Full Name
  <input type="text" name="full_name" id="full_name"  >
</label>

<!-- Year of Birth -->
<label for="dob_year">Year of Birth
  <input type="number" name="dob_year" id="dob_year" min="1900" max="2024"  >
</label>

<!-- Marital Status -->
<label for="marital_status">Marital Status
  <select name="marital_status" id="marital_status" onchange="toggleMarriageYear()">
    <option value="">-- Select --</option>
    <option value="Single">Single</option>
    <option value="Married">Married</option>
  </select>
</label>

<!-- Marriage Year -->
<div id="marriageYearField" style="display: none;">
  <label for="marriage_year">Marriage Year
    <input type="number" name="marriage_year" id="marriage_year" min="1900" max="2024">
  </label>
</div>

<!-- Applied Post -->
<label for="applied_post">Applied for the Post:
  <input type="text" name="applied_post" id="applied_post">
</label>

<!-- Permanent Address -->
<label for="permanent_address">
  Permanent Address (with Pincode) :
 
</label>
<textarea name="permanent_address" id="permanent_address" rows="2"></textarea>

<!-- Present Address -->
<label for="present_address">
  Present Address (with Pincode):
   <label style="display: inline-flex; align-items: center; cursor: pointer; font-size: 14px; color:#5a4740;">
  <input type="checkbox" id="copyAddressBtn" style="margin-right: 6px; accent-color:#5a4740;">
  Same as Permanent
</label>

</label>
<textarea name="present_address" id="present_address" rows="2"></textarea>

<script>
  document.getElementById("copyAddressBtn").addEventListener("click", function () {
    let permanent = document.getElementById("permanent_address").value.trim();
    document.getElementById("present_address").value = permanent;
  });
</script>


<!-- Aadhar Number -->
<!-- Aadhar Card Upload -->

<label for="aadhar_upload">Aadhar Card Upload: *</label>

<input type="file" 

       name="aadhar_upload" 

       id="aadhar_upload" 

       accept=".pdf,.jpg,.jpeg,.png" 

        >

<small style="font-size:12px; color:gray;">

  (Upload PDF / JPG / PNG)

</small>

<!-- Phone Number -->
<label for="phone_no">Mobile Number:
  <input type="number" name="phone_no" id="phone_no">
</label>

<!-- Languages You Speak -->
<label>Languages You Speak *</label><br>
<div id="languageSpeakGroup">
  <input type="checkbox" name="languageSpeak" value="English"> English<br>
  <input type="checkbox" name="languageSpeak" value="Tamil"> Tamil<br>
  <input type="checkbox" name="languageSpeak" value="Hindi"> Hindi<br>
  <input type="checkbox" name="languageSpeak" value="Others" id="langSpeakOthersChk"> Others
</div>
<div id="otherSpeakGroup" style="display:none; margin-top:5px;">
  <label for="otherSpeak">Other Spoken Language:
    <input type="text" id="otherSpeak" name="otherSpeak">
  </label>
</div>

<!-- Languages You Write -->
<label>Languages You Write *</label><br>
<div id="languageWriteGroup">
  <input type="checkbox" name="languageWrite" value="English"> English<br>
  <input type="checkbox" name="languageWrite" value="Tamil"> Tamil<br>
  <input type="checkbox" name="languageWrite" value="Hindi"> Hindi<br>
  <input type="checkbox" name="languageWrite" value="Others" id="langWriteOthersChk"> Others
</div>
<div id="otherWriteGroup" style="display:none; margin-top:5px;">
  <label for="otherWrite">Other Written Language:
    <input type="text" id="otherWrite" name="otherWrite">
  </label>
</div>

<!-- How do you know this company -->
<label for="knowCompany">How do you know this company? *
  <input type="text" id="knowCompany" name="knowCompany"  >
</label>

<!-- Experience -->
<label for="experience_status">Are you Fresher/Experienced *</label>
<select id="experience_status" name="experience_status" onchange="toggleExperienceTable()"  >
  <option value="">Select</option>
  <option value="Fresher">Fresher</option>
  <option value="Experienced">Experienced</option>
</select>

<!-- Experience Inputs (only shown if Experienced selected) -->
<div id="experienceTableContainer" style="display: none; margin-top: 10px;">
  <div class="experience-table">
    <label><b>Experience Details</b></label>
    <div class="input-group">
        <input type="text" id="projectname" placeholder="Project Name">
        <input type="text" id="projectlocation" placeholder="Project Location">
        <input type="text" id="projectvalue" placeholder="Project Value">
        <input type="text" id="previouscompany" placeholder="Company Name">
        <input type="text" id="companyoffice" placeholder="Company Head Office City">
        <input type="text" id="designation" placeholder="Designation">
        <input type="text" id="role" placeholder="Roles & Responsibilities">

 <!-- <input type="number" id="year" class="yearInput" placeholder="Years" min="0" step="0.1">-->
<label for="frommonth">From Year:</label>
<input type="month" id="frommonth" name="frommonth">

<label for="tomonth">To Year:</label>
<input type="month" id="tomonth" name="tomonth" onblur="validateMonths()">

<script>
  function validateMonths() {
    const fromMonth = document.getElementById("frommonth").value;
    const toMonth = document.getElementById("tomonth").value;

    if (fromMonth && toMonth && toMonth < fromMonth) {
      alert("'To Year/Month' cannot be earlier than 'From Year/Month'.");
      document.getElementById("tomonth").value = "";
      document.getElementById("tomonth").focus();
    }
  }
</script>




    </div>
    <button type="button" onclick="addExperience()"> Add </button>
  </div>

  <!-- Experience Preview -->
  <ul id="experiencePreview" style="margin-top: 10px;"></ul>

  <!-- Total Experience -->
  <label>Total Experience (in Years):
    <input type="text" name=total_experience id="totalExperience" readonly style="width: 60px;">
  </label>
</div>

<!-- EDUCATION -->
  <table>
  <tr>
    <h3>Education:</h3>
    <td data-label="Qualification">
  <label for="qual">Qualification</label>
  <select id="qual" onchange="updateStreamOptions(); toggleOther(this, 'qual_other'); toggleBoardUniversity()">
    <option value="">Select</option>
    <option value="SSLC">SSLC</option>
    <option value="HSC">HSC</option>
    <option value="UG">UG</option>
    <option value="PG">PG</option>
    <option value="Diploma">Diploma</option>
    <option value="Other">Other</option>
  </select>
  <input type="text" id="qual_other" placeholder="Specify Other" style="display:none">
</td>


    <td data-label="Specialization">
      <label>Specialization</label>
      <select id="stream" onchange="toggleOther(this, 'stream_other')">
        <option value="">Select</option>
      </select>
      <input type="text" id="stream_other" placeholder="Specify Other" style="display:none">
    </td>



    <td data-label="From">
      <label>From Year</label>
      <input type="number" id="from" name="from" placeholder="YYYY" min="1900" max="2100"  >
    </td>

    <td data-label="To">
      <label>To Year</label>
      <input type="number" id="to" name="to" placeholder="YYYY" min="1900" max="2100"   
             onblur="validateYears()">
    </td>
<script>
  function validateYears() {
    const fromYear = parseInt(document.getElementById("from").value);
    const toYear = parseInt(document.getElementById("to").value);

    if (fromYear && toYear && toYear < fromYear) {
      alert("'To Year' cannot be less than 'From Year'.");
      document.getElementById("to").value = "";
      document.getElementById("to").focus(); // move cursor back
    }
  }
</script>




    <td data-label="Medium">
      <label>Medium</label>
      <select id="medium" onchange="toggleOther(this, 'medium_other')">
        <option value="">Select</option>
        <option value="Tamil">Tamil</option>
        <option value="English">English</option>
        <option value="Hindi">Hindi</option>
        <option value="Other">Other</option>
      </select>
      <input type="text" id="medium_other" placeholder="Specify Other" style="display:none">
    </td>

   <td data-label="Board/University">
  <label for="board">Board</label>
  <select id="board" onchange="toggleOther(this, 'board_other')">
    <option value="">Select</option>
    <option value="CBSE">CBSE</option>
    <option value="Matric">Matric</option>
    <option value="State Board">State Board</option>
     <option value="ICSE">ICSE</option>
      <option value="IB">IB</option>
       <option value="IGCSE">IGCSE</option>
        <option value="NIOS">NIOS</option>
    <option value="Other">Other</option>
  </select>
  <input type="text" id="board_other" placeholder="Specify Other" style="display:none">
  <input type="text" id="board_university_input" placeholder="University Name" style="display:none">
</td>

<td data-label="College/School">
  <label>College/School</label>
  <input type="text" id="university" placeholder="College/School">
</td>


    <td data-label="Mode">
      <label>Mode of Study</label>
      <select id="mode">
         <option value="">Select</option>
        <option value="Regular">Regular</option>
        <option value="Correspondence">Correspondence</option>
      </select>
    </td>
  </tr>
</table>

  <button type="button" onclick="addEducationPreview()"> +Add</button>

  <h3>Education Preview</h3>
<div id="educationPreviewContainer"></div>


  <h3>Family Details</h3>
<table id="familyTable">
  
  <tbody id="familyBody">
    <tr>
      <td data-label="Relationship"><input type="text" id="frel"></td>
      <td data-label="Name"><input type="text" id="fname"></td>
      <td data-label="Age"><input type="text" id="fage"></td>
      <td data-label="Occupation"><input type="text" id="focc"></td>

      <td data-label="Marital Status"><input type="text" id="fmarital"></td>
      <td data-label="House Location"><input type="text" id="floc"></td>
      <td data-label="Mobile Number"><input type="text" id="fph"></td>
      <td><button type="button" onclick="addFamilyPreview()"style="min-width: 100px; padding: 6px 12px;">+ Add</button></td>
    </tr>
  </tbody>
</table>
<div id="familyPreviewContainer"></div>

<h3> Soft Skills</h3>
<table>
 
 <table>
  <tbody>
    <tr>
      <td data-label="Skill">
        <label>Skill:</label>
        <select id="skillSelect" onchange="toggleOtherSkill(this)">
          <option value="">Select..</option>
          <option value="Excel">Excel</option>
           <option value="AutoCAD">AutoCAD</option>
            <option value="Sketching">Sketching</option>
          <option value="MS Projects">MS Projects</option>                     
         <option value="Primavera">Primavera</option>
         <option value="staad">STAAD</option>
         <option value="E-Tabs">E-Tabs</option>
         <option value="BIMS">BIMS</option>
         <option value="Revit">Revit</option>
           <option value="Surveying">Surveying</option>
            <option value="Using Auto Level">Using Auto Level</option>
             <option value="Revit">Total Station Operation</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="otherSkill" placeholder="Specify Other" style="display:none;">
      </td>
      <td data-label="Proficiency">
        <label>Proficiency:</label>
        <select id="skillProficiency">
          <option value="Excellent">Excellent</option>
          <option value="Good">Good</option>
          <option value="Average">Average</option>
        </select>
      </td>
     <td data-label="Action">
   <button type="button" onclick="addSkillPreview()" style="min-width: 100px; padding: 6px 12px;">+Add</button>
     </td>

    </tr>
  </tbody>
</table>


<!-- Preview Container -->
<div id="skillPreviewContainer" style="margin-top: 20px;">
  <h4>Skills Preview</h4>
</div>
<h3>Other Details</h3>

<!-- 1-5 Questions -->
<label>1. Willing to work anywhere in India?
  <select name="willing_india"  >
    <option value="">Select</option>
    <option>Yes</option><option>No</option>
  </select>
</label>

<label>2. Willing to work in Tamil Nadu?
  <select name="willing_tn"  >
    <option value="">Select</option>
    <option>Yes</option><option>No</option>
  </select>
</label>

<label>3. Preferred work location:
  <input type="text" name="preferred_place">
</label>

<label>4. Will you stay in site camp?
  <select name="stay_in_camp"  >
    <option value="">Select</option>
    <option>Yes</option><option>No</option>
  </select>
</label>

<label>5. Vehicle owned:
  <select name="vehicle_owned" id="vehicle_owned">
    <option value="">Select</option>
    <option>Two Wheeler</option>
    <option>Four Wheeler</option>
    <option>None</option>
  </select>
</label>
<label id="licenseField" style="display:none;">License Number:
  <input type="text" name="license_no">
</label>

<!-- 6-7 Problems -->
<label>6. Any health problems?
  <select name="health_problem" id="health_problem">
    <option value="">Select</option>
    <option>Yes</option><option>No</option>
  </select>
</label>
<label id="healthDetails" style="display:none;">Specify:
  <input type="text" name="health_problem_details">
</label>

<label>7. Physically challenged?
  <select name="physically_challenged" id="physically_challenged">
    <option value="">Select</option>
    <option>Yes</option><option>No</option>
  </select>
</label>
<label id="physicalDetails" style="display:none;">Specify:
  <input type="text" name="physically_challenged_details">
</label>

<!-- 8. Reason -->
<label>8. Reason for leaving previous company:
  <textarea name="reason_for_leaving" rows="3"></textarea>
</label>

<!-- 9. References -->
<label>9. References:</label>

<div id="referenceContainer">

  <div class="referenceRow">

    <textarea name="ref_name[]" rows="2" placeholder="Name"></textarea>

    <textarea name="ref_company[]" rows="2" placeholder="Company"></textarea>

    <textarea name="ref_designation[]" rows="2" placeholder="Designation"></textarea>

    <textarea name="ref_contact[]" rows="2" placeholder="Contact No"></textarea>

  </div>

</div>

<button type="button" onclick="addReference()">Add</button>

<div id="referencePreview" style="margin-top: 10px;"></div>

<!-- 10. Known Person -->
<h3>10. Known person in P&C Group</h3>
<label>Name:
  <input type="text" name="known_person_name">
</label>

<label>Relationship:
  <select name="known_person_relationship" id="known_person_relationship">
    <option value="">Select</option>
    <option>Friend</option>
    <option>Relative</option>
    <option>Colleague</option>
  </select>
</label>

<div id="relativeDetail" style="display:none;">
  <label>If Relative, specify:
    <input type="text" name="relative_type">
  </label>
</div>

<label>Project they worked in P&C:
  <input type="text" name="known_person_project">
</label>

<!-- Resume Upload -->

<label for="resume_upload">Upload Your Resume: *

  <input type="file" name="resume_upload" id="resume_upload" 

         accept=".pdf,.doc,.docx"  >

</label>

<small style="font-size: 12px; color: #666;">

  (Accepted formats: PDF, DOC, DOCX)

</small>
<div style="text-align: center; margin-top: 30px;">
  <button type="submit" style="padding: 12px 30px; font-size: 16px; width: 220px;">Submit</button>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" style="
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 9999;
">
    <div class="spinner"></div>
    <div style="margin-top: 15px; font-size: 18px; color: #333;">
        ⏳ Submitting, please wait...
    </div>
</div>

</form>



<script>
let educationCount = 0;

const streamOptions = {
  SSLC:["1ST","2nd","3rd","4th","5th","6th","7th","8th","9th","10th"],
  HSC: ["Commerce", "Bio-Maths", "Computer Science", "Pure Science"],
  UG: ["B.Com", "B.Sc", "B.E", "BBA"],
  PG: ["M.Com", "M.Sc", "MBA"],
  Diploma: ["Civil", "EEE", "CSE"]
  
};

function toggleOther(selectEl, inputId) {
  const inputEl = document.getElementById(inputId);
  if (!inputEl) return; // guard
  inputEl.style.display = selectEl.value === "Other" ? "block" : "none";
}
function toggleBoardUniversity() {
  const qual = document.getElementById("qual").value;
  const boardSelect = document.getElementById("board");
  const boardOther = document.getElementById("board_other");
  const universityInput = document.getElementById("board_university_input"); // updated ID
  const boardLabel = document.querySelector("label[for='board']");

  if (qual === "SSLC" || qual === "HSC") {
    boardSelect.style.display = "block";
    boardOther.style.display = "none";
    universityInput.style.display = "none";
    if (boardLabel) boardLabel.innerText = "Board";
  } else {
    boardSelect.style.display = "none";
    boardOther.style.display = "none";
    universityInput.style.display = "block";
    if (boardLabel) boardLabel.innerText = "University";
  }
}


function updateStreamOptions() {
  const qualEl = document.getElementById("qual");
  const streamDropdown = document.getElementById("stream");
  const otherInput = document.getElementById("stream_other");
  if (!qualEl || !streamDropdown || !otherInput) return; // guard

  const qual = qualEl.value;
  streamDropdown.innerHTML = `<option value="">Select</option>`;

  if (streamOptions[qual]) {
    streamOptions[qual].forEach(option => {
      const opt = document.createElement("option");
      opt.value = option;
      opt.textContent = option;
      streamDropdown.appendChild(opt);
    });
  }

  const otherOpt = document.createElement("option");
  otherOpt.value = "Other";
  otherOpt.textContent = "Other";
  streamDropdown.appendChild(otherOpt);

  streamDropdown.value = "";
  otherInput.value = "";
  otherInput.style.display = "none";
}

function addEducationPreview() {
  const qual = document.getElementById("qual").value === "Other"
    ? document.getElementById("qual_other").value
    : document.getElementById("qual").value;

  const stream = document.getElementById("stream").value === "Other"
    ? document.getElementById("stream_other").value
    : document.getElementById("stream").value;

  const medium = document.getElementById("medium").value === "Other"
    ? document.getElementById("medium_other").value
    : document.getElementById("medium").value;

  let boardOrUniversity = "";
  if (qual === "SSLC" || qual === "HSC") {
    boardOrUniversity = document.getElementById("board").value === "Other"
      ? document.getElementById("board_other").value
      : document.getElementById("board").value;
  } else {
    boardOrUniversity = document.getElementById("board_university_input").value;
  }

  const from = document.getElementById("from").value;
  const to = document.getElementById("to").value;
  const collegeSchool = document.getElementById("university").value;
  const mode = document.getElementById("mode").value;

  if (!qual || !stream || !from || !to || !medium || !boardOrUniversity || !collegeSchool || !mode) {
    alert("Please fill in all fields.");
    return;
  }

  educationCount++;
  const container = document.getElementById("educationPreviewContainer");
  const line = document.createElement("div");
  line.className = "edu-preview-line";
  line.innerHTML = `
    <strong>${educationCount}.</strong> 
    ${escapeHtml(qual)} - ${escapeHtml(stream)} - ${escapeHtml(from)} to ${escapeHtml(to)} - 
    ${escapeHtml(medium)} - ${escapeHtml(boardOrUniversity)} - ${escapeHtml(mode)} - ${escapeHtml(collegeSchool)}
    <button type="button" onclick="this.parentElement.remove(); renumberEducation()">❌</button>
  `;
  container.appendChild(line);

  // Reset inputs
  document.getElementById("qual").value = "";
  const qo = document.getElementById("qual_other"); if (qo) { qo.value = ""; qo.style.display = "none"; }

  document.getElementById("stream").value = "";
  const so = document.getElementById("stream_other"); if (so) { so.value = ""; so.style.display = "none"; }

  document.getElementById("from").value = "";
  document.getElementById("to").value = "";

  document.getElementById("medium").value = "";
  const mo = document.getElementById("medium_other"); if (mo) { mo.value = ""; mo.style.display = "none"; }

  document.getElementById("board").value = "";
  const bo = document.getElementById("board_other"); if (bo) { bo.value = ""; bo.style.display = "none"; }
  document.getElementById("board_university_input").value = "";

  document.getElementById("university").value = "";
  document.getElementById("mode").value = "";
}


function renumberEducation() {
  const lines = document.querySelectorAll('#educationPreviewContainer .edu-preview-line');
  educationCount = 0;
  lines.forEach((line, index) => {
    educationCount++;
    const strong = line.querySelector("strong");
    if (strong) strong.innerText = `${index + 1}.`;
  });
}

// Toggle experience table based on selection
function toggleExperienceTable() {
    const statusEl = document.getElementById("experience_status");
    const container = document.getElementById("experienceTableContainer");
    if (!statusEl || !container) return;
    const status = statusEl.value;
    container.style.display = (status === "Experienced") ? "block" : "none";
    if (status !== "Experienced") {
        const ep = document.getElementById("experiencePreview"); if (ep) ep.innerHTML = "";
        const te = document.getElementById("totalExperience"); if (te) te.value = "";
    }
}
function escapeHtml(text) {
  return text.replace(/[&<>"']/g, function(m) {
    return ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    })[m];
  });
}

function calculateTotalExperience() {
  let total = 0;
  document.querySelectorAll("#experiencePreview .yearVal").forEach(el => {
    total += parseFloat(el.textContent) || 0;
  });
  const te = document.getElementById("totalExperience");
  if (te) te.value = total.toFixed(1);
}

// Add Example
function addExperience() {
  const company = document.getElementById("previouscompany").value.trim();
  const office = document.getElementById("companyoffice").value.trim();
  const designation = document.getElementById("designation").value.trim();
  const projectname = document.getElementById("projectname").value.trim();
  const projectlocation = document.getElementById("projectlocation").value.trim();
  const projectvalue = document.getElementById("projectvalue").value.trim();
  const role = document.getElementById("role").value.trim();
  const frommonth = document.getElementById("frommonth").value;
  const tomonth = document.getElementById("tomonth").value;

  if (!company || !role || !frommonth || !tomonth) {
    alert("Please fill all fields");
    return;
  }

  // experience calc
  const from = new Date(frommonth);
  const to = new Date(tomonth);
  let expYears = (to - from) / (1000 * 60 * 60 * 24 * 365);
  expYears = expYears.toFixed(1);

  const li = document.createElement("li");
  li.innerHTML = `
    <b>${company}</b> (${office})<br>
    Designation: ${designation}<br>
    Project: ${projectname} - ${projectlocation}<br>
    Value: ${projectvalue}<br>
    Role: ${role}<br>
    From: ${frommonth} → To: ${tomonth}<br>
    Experience: <span class="yearVal">${expYears}</span> yrs
    <button type="button" onclick="removeExperience(this)">❌</button>
  `;

  document.getElementById("experiencePreview").appendChild(li);
 

  // ✅ total update
  calculateTotalExperience();

  // ✅ Reset all input fields (KADASIYILA podanum)
  document.getElementById("previouscompany").value = "";
  document.getElementById("companyoffice").value = "";
  document.getElementById("designation").value = "";
  document.getElementById("projectname").value = "";
  document.getElementById("projectlocation").value = "";
  document.getElementById("projectvalue").value = "";
  document.getElementById("role").value = "";
  document.getElementById("frommonth").value = "";
  document.getElementById("tomonth").value = "";
}

  // ✅ total update
  calculateTotalExperience();


function removeExperience(btn) {
  btn.parentElement.remove();
  calculateTotalExperience();
}

  // Show/Hide Other Language - Speak
  // moved into DOMContentLoaded to avoid null errors

// Family Preview
let familyCount = 0;

function addFamilyPreview() {
  const name = document.getElementById("fname").value;
  const age = document.getElementById("fage").value;
  const rel = document.getElementById("frel").value;
  const occ = document.getElementById("focc").value;
  const marital = document.getElementById("fmarital").value;
  const loc = document.getElementById("floc").value;
  const ph = document.getElementById("fph").value;

  if (!name || !age || !rel || !occ || !marital || !loc || !ph) {
    alert("Please fill in all family fields.");
    return;
  }

  familyCount++;
  const container = document.getElementById("familyPreviewContainer");
  const line = document.createElement("div");
  line.className = "edu-preview-line";
  line.innerHTML = `\n    <strong>${familyCount}.</strong> ${escapeHtml(rel)},${escapeHtml(name)}, ${escapeHtml(age)} yrs,  ${escapeHtml(occ)}, ${escapeHtml(marital)}, ${escapeHtml(loc)}, 📞 ${escapeHtml(ph)}\n    <button type="button" onclick="this.parentElement.remove(); renumberFamily()">❌</button>\n  `;
  container.appendChild(line);

 document.getElementById("frel").value = "";
  document.getElementById("fname").value = "";
  document.getElementById("fage").value = "";
 document.getElementById("focc").value = "";
  document.getElementById("fmarital").value = "";
  document.getElementById("floc").value = "";
  document.getElementById("fph").value = "";
}
async function fileToBase64(file) {

  return new Promise((resolve, reject) => {

    const reader = new FileReader();

    reader.onload = () => resolve(reader.result.split(',')[1]); // Remove data:*/*;base64, part

    reader.onerror = error => reject(error);

    reader.readAsDataURL(file);

  });

}


function renumberFamily() {
  const lines = document.querySelectorAll('#familyPreviewContainer .edu-preview-line');
  familyCount = 0;
  lines.forEach((line, index) => {
    familyCount++;
    const strong = line.querySelector("strong"); if (strong) strong.innerText = `${index + 1}.`;
  });
}

// Skill Preview
let skillCount = 0;

function toggleOtherSkill(select) {
  const otherInput = document.getElementById("otherSkill");
  if (!otherInput) return;
  if (select.value === "Other") {
    otherInput.style.display = "inline-block";
  } else {
    otherInput.style.display = "none";
    // do not clear value to avoid losing user input accidentally
  }
}

function addSkillPreview() {
  const skillSelect = document.getElementById("skillSelect");
  const otherSkillInput = document.getElementById("otherSkill");
  const proficiencySelect = document.getElementById("skillProficiency");
  if (!skillSelect || !proficiencySelect) return;

  let skill = skillSelect.value;
  if (skill === "Other") {
    skill = otherSkillInput.value.trim();
    if (!skill) {
      alert("Please enter a skill name for 'Other'");
      return;
    }
  }

  const proficiency = proficiencySelect.value;

  if (!skill || !proficiency) {
    alert("Please select a skill and proficiency.");
    return;
  }

  skillCount++;
  const container = document.getElementById("skillPreviewContainer");
  const line = document.createElement("div");
  line.className = "edu-preview-line";
  line.innerHTML = `\n    <strong>${skillCount}.</strong> <b>${escapeHtml(skill)}</b> - <b>${escapeHtml(proficiency)}</b>\n    <button type="button" onclick="this.parentElement.remove(); renumberSkills()">❌</button>\n  `;
  container.appendChild(line);

  // Reset inputs
  skillSelect.selectedIndex = 0;
  proficiencySelect.value = "Excellent";
  if (otherSkillInput) { otherSkillInput.value = ""; otherSkillInput.style.display = "none"; }
}

function renumberSkills() {
  const lines = document.querySelectorAll('#skillPreviewContainer .edu-preview-line');
  skillCount = 0; // RESET before renumbering

  lines.forEach((line, index) => {
    skillCount++;
    const strong = line.querySelector("strong"); if (strong) strong.innerText = `${skillCount}.`;
  });
}

// Reference Preview
let refCount = 1;


function addReference() {
  const row = document.querySelector(".referenceRow");
  if (!row) return;

  // Get values
  const name = row.querySelector('textarea[name="ref_name[]"]').value.trim();
  const company = row.querySelector('textarea[name="ref_company[]"]').value.trim();
  const designation = row.querySelector('textarea[name="ref_designation[]"]').value.trim();
  const contact = row.querySelector('textarea[name="ref_contact[]"]').value.trim();



  // Create preview block
  const preview = document.createElement("div");
  preview.innerHTML = `
    <strong>${refCount}.</strong> 
   ${escapeHtml(name)} | 
   ${escapeHtml(company)} | 
    ${escapeHtml(designation)} | 
     ${escapeHtml(contact)}
    <button type="button" onclick="this.parentElement.remove(); reindexReferences()">❌</button>
  `;
  document.getElementById("referencePreview").appendChild(preview);

  refCount++;

  // Reset fields after adding
  row.querySelectorAll("textarea").forEach(el => el.value = "");
}

function reindexReferences() {
  const previews = document.querySelectorAll("#referencePreview div");
  refCount = 1;
  previews.forEach((el, idx) => {
    const strong = el.querySelector("strong"); if (strong) strong.innerText = `${idx + 1}.`;
  });
}

function toggleMarriageYear() {
  const maritalStatus = document.getElementById("marital_status");
  const marriageField = document.getElementById("marriageYearField");
  if (!maritalStatus || !marriageField) return;
  marriageField.style.display = maritalStatus.value === "Married" ? "block" : "none";
}

document.addEventListener("DOMContentLoaded", function () {
    // Initial stream options setup
    updateStreamOptions();

    // Conditional field display
    const maritalEl = document.getElementById("marital_status"); if (maritalEl) maritalEl.addEventListener("change", toggleMarriageYear);

    const vehicleEl = document.getElementById("vehicle_owned"); if (vehicleEl) vehicleEl.addEventListener("change", function () {
        const show = ["Two Wheeler", "Four Wheeler"].includes(this.value);
        const licenseField = document.getElementById("licenseField"); if (licenseField) licenseField.style.display = show ? "block" : "none";
    });

    const healthEl = document.getElementById("health_problem"); if (healthEl) healthEl.addEventListener("change", function () {
        const healthDetails = document.getElementById("healthDetails"); if (healthDetails) healthDetails.style.display = this.value === "Yes" ? "block" : "none";
    });

    const physEl = document.getElementById("physically_challenged"); if (physEl) physEl.addEventListener("change", function () {
        const physicalDetails = document.getElementById("physicalDetails"); if (physicalDetails) physicalDetails.style.display = this.value === "Yes" ? "block" : "none";
    });

    const knownRelEl = document.getElementById("known_person_relationship"); if (knownRelEl) knownRelEl.addEventListener("change", function () {
        const relativeDetail = document.getElementById("relativeDetail"); if (relativeDetail) relativeDetail.style.display = this.value === "Relative" ? "block" : "none";
    });

    // Move language checkbox listeners here to avoid null errors
    const langSpeakChk = document.getElementById("langSpeakOthersChk");
    if (langSpeakChk) {
      langSpeakChk.addEventListener("change", function () {
        const otherSpeakGroup = document.getElementById("otherSpeakGroup"); if (otherSpeakGroup) otherSpeakGroup.style.display = this.checked ? "block" : "none";
      });
    }

    const langWriteChk = document.getElementById("langWriteOthersChk");
    if (langWriteChk) {
      langWriteChk.addEventListener("change", function () {
        const otherWriteGroup = document.getElementById("otherWriteGroup"); if (otherWriteGroup) otherWriteGroup.style.display = this.checked ? "block" : "none";
      });
    }

    // Add listener to qual so stream updates on change
    const qualEl2 = document.getElementById("qual"); if (qualEl2) qualEl2.addEventListener("change", updateStreamOptions);

});


// Main form submission
// Main form submission
const candidateFormEl = document.getElementById("candidateForm");
if (candidateFormEl) candidateFormEl.addEventListener("submit", submitCandidateForm);

async function submitCandidateForm(event) {

  event.preventDefault();
  const form = document.getElementById("candidateForm");
  if (!form) return;
  const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
  // prevent double submit

  if (submitBtn) { submitBtn.disabled = true; }
  // Show loading overlay

  document.getElementById("loadingOverlay").style.display = "flex";
  try {

    // Prepare FormData from form fields (excluding files)

    const formData = new FormData(form);
    // Convert Aadhar and Resume files to base64 and append as fields
    const aadharFile = document.getElementById("aadhar_upload").files[0];
    const resumeFile = document.getElementById("resume_upload").files[0];
    if (aadharFile) {
      const base64Aadhar = await fileToBase64(aadharFile);
      formData.append("aadhar_base64", base64Aadhar);
      formData.append("aadhar_name", aadharFile.name);
      formData.append("aadhar_type", aadharFile.type);
    }
    if (resumeFile) {
      const base64Resume = await fileToBase64(resumeFile);
     formData.append("resume_base64", base64Resume);
      formData.append("resume_name", resumeFile.name);
      formData.append("resume_type", resumeFile.type);
    }

    // Append dynamic sections (languages etc)
    function getCheckedValues(name) {
      return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
        .map(el => el.value);
    }
    let selectedSpeak = getCheckedValues("languageSpeak");
    const otherSpeakInput = document.getElementById("otherSpeak");
    const otherSpeakChecked = document.getElementById("langSpeakOthersChk")?.checked;
    if (otherSpeakChecked && otherSpeakInput?.value.trim() !== "") {
      selectedSpeak.push(otherSpeakInput.value.trim());
    }
    formData.append("languageSpeakCombined", selectedSpeak.join(", "));
    let selectedWrite = getCheckedValues("languageWrite");
    const otherWriteInput = document.getElementById("otherWrite");
    const otherWriteChecked = document.getElementById("langWriteOthersChk")?.checked;
    if (otherWriteChecked && otherWriteInput?.value.trim() !== "") {
      selectedWrite.push(otherWriteInput.value.trim());
    }
    formData.append("languageWriteCombined", selectedWrite.join(", "));
    // Append JSON stringified dynamic preview data
    formData.append("educationData", JSON.stringify(collectPreviewData("#educationPreviewContainer")));
    formData.append("experienceData", JSON.stringify(collectPreviewData("#experiencePreview")));
    formData.append("familyData", JSON.stringify(collectPreviewData("#familyPreviewContainer")));
    formData.append("skillsData", JSON.stringify(collectPreviewData("#skillPreviewContainer")));
    formData.append("referencesData", JSON.stringify(collectPreviewData("#referencePreview")));
    // Append conditional fields
    formData.append("marriageYear", document.getElementById("marriage_year")?.value || "");
    formData.append("healthProblemDetails", document.getElementById("health_problem_details")?.value || "");
    formData.append("physicallyChallengedDetails", document.getElementById("physically_challenged_details")?.value || "");
    formData.append("relativeType", document.getElementById("relative_type")?.value || "");
    // Send to Google Apps Script endpoint

    const GAS_URL = "https://script.google.com/macros/s/AKfycbx3PhqA-dxr3nehoG3CNmXtihe3mFFp-WdP9up690ctXjdFdVP7_SXgcr8sDgvFZNEHxA/exec";
    const response = await fetch(GAS_URL, {
      method: "POST",
      body: formData,
    });
    const data = await response.json();
    alert(data.message || "Form submitted successfully!");
    if (data.result === "success") {
      form.reset();
      // Clear previews and counters as in your original code
      document.getElementById("educationPreviewContainer").innerHTML = "";
      document.getElementById("familyPreviewContainer").innerHTML = "";
      document.getElementById("skillPreviewContainer").innerHTML = "";
     document.getElementById("referencePreview").innerHTML = "";
      document.getElementById("experiencePreview").innerHTML = "";
      document.getElementById("totalExperience").value = "";
      educationCount = familyCount = skillCount = 0;
      refCount = 1;
    }
  } catch (error) {
    console.error("Error submitting form:", error);
    alert("Error submitting form. Please try again.");
  } finally {
    document.getElementById("loadingOverlay").style.display = "none";
    if (submitBtn) { submitBtn.disabled = false; }
  }

}
// Helper: Collect preview data
function collectPreviewData(containerSelector) {
    const container = document.querySelector(containerSelector);
    if (!container) return [];

    const data = [];
    container.childNodes.forEach(node => {
        if (node.nodeType === 1) {
            let text = node.innerText.trim();
            text = text.replace(/\s*❌.*$/s, "");
            text = text.replace(/\s+/g, ' ').trim();
            text = text.replace(/^\d+\.\s*/, '');
            if (text) data.push(text);
        }
    });
    return data;
}

function escapeHtml(unsafe) {
    if (unsafe === undefined || unsafe === null) return '';
    return String(unsafe)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\"/g, "&quot;")
        .replace(/'/g, "&#039;");
}



</script>


</body>
</html>
